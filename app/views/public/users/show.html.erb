<div class="container">
  <div class="row">
    <% if @user.is_deleted == true %>
      <p class="mx-auto mt-5">こちらのユーザーは退会しています。</p>
    <% else %>
      <div class="col-md-8 mx-auto mt-3 bg-white p-4">
        <%= render 'public/users/show', user: @user %>
        <ul class="nav nav-pills nav-justified" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" id="item1-tab" data-toggle="tab" href="#item1" role="tab" aria-controls="item1" aria-selected="true"><%= @user.reviews.count %> レビュー</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="item2-tab" data-toggle="tab" href="#item2" role="tab" aria-controls="item2" aria-selected="false"><%= @user.bookmarks.count %> 見たい</a>
          </li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane fade show active" id="item1" role="tabpanel" aria-labelledby="item1-tab">
            <div class="text-right mt-3">
              <%= form_with model: @review, url: user_path, method: :get, local: true do |f| %>
                <%= f.select :sort, options_for_select({"投稿が新しい順": "new", "投稿が古い順": "old", "観劇日が新しい順": "watched", "観劇日が古い順": "watched_a", "評価が高い順": "rate", "いいねが多い順": "favorites", "コメントが多い順": "comments" },params[:sort]), class: "form-control" %>
                <%= f.submit "並び替え" %>
              <% end %>
            </div>
            <%= render 'public/reviews/index', reviews: @reviews %>
          </div>
          <div class="tab-pane fade" id="item2" role="tabpanel" aria-labelledby="item2-tab">
            <% @bookmarks.each do |bookmark| %>
              <% stage = Stage.find_by(id: bookmark.stage_id) %>
              <div class="p-4 border-bottom">
                <div class="mt-1"><strong><%= link_to stage.name, stage_path(stage) %></strong></div>
                  <div class="mt-3">
                    公演期間：<%= stage.start_date.strftime("%Y年%-m月%-d日") %>〜<%= stage.end_date.strftime("%Y年%-m月%-d日") %>　/　ジャンル：<%= link_to stage.genre.name, stages_path(genre_id: stage.genre.id) %>
                  </div>
                  <div class="d-flex align-items-center">
                    <div id="star-rate-<%= stage.id %>"></div>
                    <div class="rating-score"><%= stage.reviews.average(:rate).to_f.round(1) %></div>
                    <%= link_to reviews_path(stage_id: stage.id) do %>
                      <div>全<%= stage.reviews.count %>件</div>
                    <% end %>
                  </div>
              </div>
              <%= render 'public/stages/rate_average', stage: stage %>
            <% end %>
            <div class="mt-3 d-flex justify-content-center"><%= paginate @reviews %></div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
